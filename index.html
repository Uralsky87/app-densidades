<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Densidades</title>

  <!-- Vista adaptada a móvil -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link rel="stylesheet" href="styles.css" />
  <link rel="manifest" href="manifest.json" />
</head>
<body>

  <!-- CABECERA CON TÍTULO + BOTÓN INFO -->
  <header class="app-header">
    <h1>Densidades</h1>
    <button id="btnInfo" class="icon-btn" aria-label="Información">i</button>
  </header>

  <!-- MENÚ PRINCIPAL -->
  <div id="main-menu" class="card">
    <h2>Menú principal</h2>
    <p>Selecciona una opción:</p>

    <button class="menu-btn" data-target="calc">Calculadora</button>
    <button class="menu-btn" data-target="disolucion">Disolución</button>
    <button class="menu-btn" data-target="productos">Materias primas</button>
    <button class="menu-btn" data-target="historial">Historial</button>

    <!-- Botón especial para la calculadora rápida -->
    <button class="menu-btn menu-btn-small menu-btn-green" data-target="calcrapida">
      Calc rápida
    </button>

    <hr class="menu-separator">

    <h3>Datos</h3>
    <button id="btnExportarDatos" class="menu-btn">Exportar datos</button>
    <button id="btnImportarDatos" class="menu-btn small-btn">Importar datos</button>

    <!-- input oculto para seleccionar el archivo de importación -->
    <input type="file" id="inputImportarDatos" accept="application/json" style="display:none" />
  </div>

  <!-- ================= CALCULADORA ================= -->
  <div id="tab-calc" class="tab">
    <div class="card">
      <button class="back-btn">← Menú principal</button>
      <h2>Cálculo</h2>

      <label for="producto">Producto:</label>
      <select id="producto"></select>

      <label for="tipoCalculo">Tipo de cálculo:</label>
      <select id="tipoCalculo">
        <option value="masa-a-vol">Masa → Volumen</option>
        <option value="vol-a-masa">Volumen → Masa</option>
      </select>

      <label for="valor">Valor:</label>
      <input type="number" id="valor" placeholder="Introduce número" />

      <label for="unidad">Unidad:</label>
      <select id="unidad">
        <option value="g">g</option>
        <option value="kg">kg</option>
        <option value="ml">mL</option>
        <option value="l">L</option>
      </select>

      <button id="btnCalcular">Calcular</button>

      <!-- Mensajes de error-->
      <div id="error" class="error"></div>

      <!-- Resultado -->
      <div id="resultado" class="resultado"></div>
    </div>
  </div>

 <!-- ================= DISOLUCIÓN ================= -->
  <div id="tab-disolucion" class="tab">
    <div class="card">
      <button class="back-btn">← Menú principal</button>
      <h2>Disolución</h2>

      <button id="btnResetDisolucion" type="button">Reset</button>

      <label for="aguaCsp">Volumen final CSP de agua:</label>
      <input type="number" id="aguaCsp" placeholder="Volumen total final en mL" />
      <small class="hint-text">El volumen final de la disolución se expresa en mL.</small>

      <h3>Materias primas</h3>
      <p class="hint-text">Añade las materias primas que forman parte de la disolución.</p>

      <div id="materiasContainer"></div>

      <button id="btnAnadirMateria" type="button">+ Añadir materia prima</button>

      <div id="disolucionError" class="error"></div>

      <button id="btnCalcularDisolucion" type="button">Calcular</button>

      <div id="disolucionResultado" class="resultado"></div>

      <button id="btnDetallesDisolucion" type="button" class="hidden">Detalles</button>
      <div id="detallesDisolucion" class="detalles hidden"></div>
    </div>
  </div>

  <!-- ================= CALC RÁPIDA ================= -->
  <div id="tab-calcrapida" class="tab">
    <div class="card">
      <button class="back-btn">← Menú principal</button>
      <h2>Calc rápida</h2>

      <!-- Pantalla de la calculadora -->
      <div id="calcDisplay" class="calc-display">0</div>

      <!-- Layout: teclado numérico + operaciones a la derecha -->
      <div class="calc-layout">
        <div class="calc-keypad">
          <button class="calc-btn" data-calc-num="7">7</button>
          <button class="calc-btn" data-calc-num="8">8</button>
          <button class="calc-btn" data-calc-num="9">9</button>

          <button class="calc-btn" data-calc-num="4">4</button>
          <button class="calc-btn" data-calc-num="5">5</button>
          <button class="calc-btn" data-calc-num="6">6</button>

          <button class="calc-btn" data-calc-num="1">1</button>
          <button class="calc-btn" data-calc-num="2">2</button>
          <button class="calc-btn" data-calc-num="3">3</button>

          <button class="calc-btn" id="calcDot">.</button>
          <button class="calc-btn" data-calc-num="0">0</button>
          <button class="calc-btn calc-clear-btn" id="calcClear">C</button>
        </div>

        <div class="calc-ops">
          <button class="calc-op-btn" data-calc-op="+">+</button>
          <button class="calc-op-btn" data-calc-op="-">−</button>
          <button class="calc-op-btn" data-calc-op="*">×</button>
          <button class="calc-op-btn" data-calc-op="/">÷</button>
          <button class="calc-op-btn calc-equals-btn" id="calcEquals">=</button>
        </div>
      </div>

      <h3>Historial</h3>
      <ul id="calcHistory" class="calc-history">
        <li class="calc-history-empty">No hay operaciones todavía.</li>
      </ul>
    </div>
  </div>

  <!-- ================= PRODUCTOS ================= -->
  <div id="tab-productos" class="tab">
    <div class="card">
      <button class="back-btn">← Menú principal</button>
      <h2>Materias primas</h2>

      <button id="btnNuevoProducto">Añadir materia prima</button>

      <table id="tablaProductos">
        <thead>
          <tr>
            <th>Nombre</th>
            <th>Densidad</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody><!-- Se rellena con JS --></tbody>
      </table>
    </div>
  </div>

   <!-- ================= HISTORIAL ================= -->
  <div id="tab-historial" class="tab">
    <div class="card">
      <button class="back-btn">← Menú principal</button>
      <h2>Historial</h2>

      <nav class="subnav">
        <button class="subtab-btn active-subtab" data-subtab="calculos">Cálculos</button>
        <button class="subtab-btn" data-subtab="disoluciones">Disoluciones</button>
      </nav>

      <!-- Subpestaña: Historial de cálculos -->
      <div id="subtab-calculos" class="subtab-panel active-subtab-panel">
        <button id="btnBorrarHistorialCalculos">Borrar historial</button>

        <table id="tablaHistorialCalculos">
          <thead>
            <tr>
              <th>Fecha</th>
              <th>M.P.</th>
              <th>Entrada</th>
              <th>Resultado</th>
            </tr>
          </thead>
          <tbody>
            <!-- Aquí se rellena con JS -->
          </tbody>
        </table>
      </div>

      <!-- Subpestaña: Historial de disoluciones -->
      <div id="subtab-disoluciones" class="subtab-panel">
        <button id="btnBorrarHistorialDisoluciones">Borrar historial de disoluciones</button>

        <table id="tablaHistorialDisoluciones">
          <thead>
            <tr>
              <th>Fecha</th>
              <th>Volumen final</th>
              <th>Materias primas</th>
              <th>Agua CSP</th>
            </tr>
          </thead>
          <tbody>
            <!-- Aquí se rellena con JS -->
          </tbody>
        </table>
      </div>

    </div>
  </div>

  <!-- MODAL DE INFORMACIÓN / CLÁUSULA -->
  <div id="info-modal" class="modal hidden">
    <div class="card modal-card">
      <h2>Información</h2>
      <p class="info-text">
        Esta aplicación es una herramienta de apoyo para cálculos de volumen y densidad.
        Los resultados dependen de la corrección de los datos introducidos por el usuario
        (densidades, cantidades, unidades, etc.).
      </p>
      <p class="info-text">
        La responsabilidad final de verificar los cálculos y de la preparación recae siempre
        en el técnico o profesional que realiza la fórmula y en los procedimientos
        de control del laboratorio.
      </p>
      <button id="btnCerrarInfo">Cerrar</button>
    </div>
  </div>

  <script src="app.js"></script>
  <script>
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("service-worker.js")
        .then(() => console.log("SW registrado"))
        .catch(err => console.error("SW error:", err));
    }
  </script>
</body>
</html>